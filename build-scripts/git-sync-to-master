#!/bin/smash -s

var push = false;
if (parameter[1] == '-p') push = true;

var branch = system.read("git branch | grep '*'").output.split(" ")[1];
if (branch == 'master') {
	echo.error("wrong branch for sync to master");
	exit(1);
}

if (system('git checkout master') === 0) {
	if (system('git merge ' + branch) === 0) {
		if (push) system('git push');
	} else {
		system('git checkout '+ branch);
		exit(1);
	}
	system('git checkout '+ branch);
} else exit(1);
